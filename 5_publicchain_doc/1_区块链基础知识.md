##### 比特币基础知识

背景：2008年爆发全球金融危机。

1.2008年，中本聪发表了一篇论文《bitcoin：A   peer to peer electronic cash system》。

2.2009年1月3日，中本聪发出首个实现了比特币算法的客户端程序，创世区块产生。

3.比特币的规则：

1）总量为2100万枚

2）初识记账奖励为50枚比特币。每大约10分钟，比特币网络出一个块，每产生21万个区块奖励，奖励就会减半。

3）每一个区块都有一个固定的编号，创世区块编号为0，该编号叫做区块的高度，该区块后续区块的个数为区块的深度。

4）比特币区块的产生大约是10分钟，每产生21万个区块大约就需要4年。因此每4年挖矿奖励减半。

5）区块中的时间戳数据是指格林威治时间1970年01月01日00分00秒起至现在的总秒数

##### 比特币定义

比特币是基于P2P网络的一种分布式系统。在此系统中，基于非对称加密技术（公开密钥算法）以保证交易的安全性。

##### 比特币与区块链的关系

1）区块链是比特币的底层技术，比特币是区块链的第一个应用。

2）比特币是一种数字货币，仅仅是区块链技术的应用场景，区块链技术可以用在很多的场景中。

3）区块链并不是新技术，而是一系列技术的集成。其中包括：非对称加密技术，时间戳，共识机制等。

4）比特币是世界上第一条区块链，是区块链1.0时代，数字货币领域。区块链2.0时代的代表是以太坊，可以供开发者开发智能合约和DApp开发。超级账本是3.0的代表，面相企业的分布式账本平台，引入权限管理模块。

区块链中的核心技术：

1）P2P网络：点对点交易，没有中间方。

2）分布式存储：所有节点信息统一，交易不可篡改，修改一个节点信息，需要其他节点共同修改。

3）加密算法：确保交易不可篡改，无法抵赖和破坏，且保护了用户隐私和交易记录的信息安全。交易可被追溯。

4）共识算法：又称共识机制，用来实现网络中的协同工作。

5）智能合约：通过程序自动执行某种策略。

区块链的类分

按照准入机制分为三类：共有链，联盟链，私有链。

1.公有链：公开透明，开放生态的交易网络。自由加入和退出。代表：比特币，以太坊。

2.联盟链：半封闭生态的交易网络，存在对等的不信任节点。代表是超级账本项目Hyperledger 中的Fabric网络，典型代表。

3.私有链：完全封闭生态的存储网络，仅仅采用区块链技术进行记账，所有节点都是可信任的。如某个集团或者某个内部的记账网络。

##### 区块链类型引入的权衡与障碍

1.主流金融机构考虑到自主及监管控制，很难接纳公邮链。

2.私有链和公有链架构差异较大。如公有链中的挖矿，共识，代币激励机制等核心模块，在私有链环境中根本就不存在。反之，公有链中缺乏诸如身份认证，权限管理等在私有链中非常必要的模块。

3.私有链盒联盟链目前还不成熟。

##### 比特币相关的概念及问题

Difficulty：难度。比特币网络会通过调整“难度”这个变量来控制生成工作量证明所需要的算力。

Bits：难度目标。使整个网络的计算里大致10分钟左右产生一个区块所需要的难度数值即为难度目标；Bits是用来存储难度目标的16进制数值；Bits值越小，难度越大，挖矿难度越大。

难度重定：全网中每新增2016个区块，全网难度将重新计算，新难度值依据前2016个区块的哈希算力决定；因为每10分钟产生一个区块，2016个区块所需要的时间大概是14天，也就是两周，这也是为什么比特币网络大概两周左右会进行一次难度调整的原因。

##### 区块结构

结构：比特币中的一个区块由区块头，区块体两部分组成。

内容：区块体记载了交易详情，交易计数器，以及区块的大小。

**区块头结构：每个区块的前80个字节（640bits）是区块头。区块头包含6个字短信息：**

**1）Version版本号，占4个字节。**
**2）前一个区块的hash，占32字节。**
**3）当前区块所有交易的默克尔根，占32个字节。**
**4）时间戳，占4个字节。**
**5）难度目标Bits，占4个字节。**
**6）随机数Nonce，占4个字节。**

##### 两个面试题

1.比特币区块的排序规则是什么？后面的区块时间戳可以比前一个区块的时间戳小吗？
eg：比特币系统是一个P2P网络，没有中心服务器，因此每个节点的时间戳可能都不一样。在这种情况下，比特币系统规定：1.新区块时间戳只要大于前11个区块的平均时间戳即为有效；2.不超过当前网络时间2个小时也即为有效。因此，有了这两个规定，在比特币网络中，是有可能出现后一个区块时间戳比前一个区块的时间戳大的情况的。

2.对与Nonce，你了解哪些？
eg：Nonce是全网矿工计算当前区块Hash值的核心参数；Nonce的取值范围是0-2的32次方（大概是42亿）

##### 比特币的区块结构

```
{ "hash": "00000000d1145790a8694403d4063f323d499e655c83426834d4ce2f8dd4a2ee", "ver": 1, "prev_block": "000000002a22cfee1f2c846adbd12b3e183d4f97683f85dad08a79780a84bd55", "mrkl_root": "7dac2c5666815c17a3b36427de37bb9d2e2c5ccec3f8633eb91a4205cb4c10ff", "time": 1231731025, "bits": 486604799, "nonce": 1889418792, "n_tx": 2, "size": 490, "tx": [ { "hash": "b1fea52486ce0c62bb442b530a3f0132b826c74e473d1f2c220bfa78111c5082", "ver": 1, "vin_sz": 1, "vout_sz": 1, "lock_time": 0, "size": 134, "in": [ { "prev_out": { "hash": "0000000000000000000000000000000000000000000000000000000000000000", "n": 4294967295 }, "coinbase": "04ffff001d0102" } ], "out": [ { "value": "50.00000000", "scriptPubKey": "04d46c4968bde02899d2aa0963367c7a6ce34eec332b32e42e5f3407e052d64ac625da6f0718e7b302140434bd725706957c092db53805b821a85b23a7ac61725b OP_CHECKSIG" } ], "nid": "c56705435de47674259d6c92125907645d4fb512fa8e7f31457f5f29ba983d80" }, { "hash": "f4184fc596403b9d638783cf57adfe4c75c605f6356fbc91338530e9831e9e16", "ver": 1, "vin_sz": 1, "vout_sz": 2, "lock_time": 0, "size": 275, "in": [ { "prev_out": { "hash": "0437cd7f8525ceed2324359c2d0ba26006d92d856a9c20fa0241106ee5a597c9", "n": 0 }, "scriptSig": "304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901" } ], "out": [ { "value": "10.00000000", "scriptPubKey": "04ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6cd84c OP_CHECKSIG", "next_in": { "hash": "ea44e97271691990157559d0bdd9959e02790c34db6c006d779e82fa5aee708e", "n": 0 } }, { "value": "40.00000000", "scriptPubKey": "0411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3 OP_CHECKSIG", "next_in": { "hash": "a16f3ce4dd5deb92d98ef5cf8afeaf0775ebca408f708b2146c4fb42b41e14be", "n": 0 } } ], "nid": "a1629e004eb3d703ecf3807f976e402a626d84c559f8eab1450adf207619f319" } ], "mrkl_tree": [ "b1fea52486ce0c62bb442b530a3f0132b826c74e473d1f2c220bfa78111c5082", "f4184fc596403b9d638783cf57adfe4c75c605f6356fbc91338530e9831e9e16", "7dac2c5666815c17a3b36427de37bb9d2e2c5ccec3f8633eb91a4205cb4c10ff" ], "next_block": "00000000c9ec538cab7f38ef9c67a95742f56ab07b0a37c5be6b02808dbfb4e0" }
```

**区块整体结构**

| 字节 | 字段       | 说明                                                         |
| ---- | ---------- | ------------------------------------------------------------ |
| 4    | 区块大小   | 用字节表示的该字段之后的区块大小                             |
| 80   | 区块头     | 组成区块头的几个字段                                         |
| 1-9  | 交易计数器 | 该区块包含的交易数量，包含coinbase交易                       |
| 不定 | 交易       | 记录在区块里的交易信息，使用原生的交易信息格式，并且交易在数据流中的位置必须与Merkle树的叶子节点顺序一致 |

- 区块头结构

  | 字节 | 字段           | 说明                                                         |
  | ---- | -------------- | ------------------------------------------------------------ |
  | 4    | 版本           | 区块版本号，表示本区块遵守的验证规则                         |
  | 32   | 父区块头哈希值 | 前一区块的哈希值，使用SHA256(SHA256(父区块头))计算           |
  | 32   | Merkle根       | 该区块中交易的Merkle树根的哈希值，同样采用SHA256(SHA256())计算 |
  | 4    | 时间戳         | 该区块产生的近似时间，精确到秒的UNIX时间戳，必须严格大于前11个区块时间的中值，同时全节点也会拒绝那些超出自己2个小时时间戳的区块 |
  | 4    | 难度目标       | 该区块工作量证明算法的难度目标，已经使用特定算法编码         |
  | 4    | Nonce          | 为了找到满足难度目标所设定的随机数，为了解决32位随机数在算力飞升的情况下不够用的问题，规定时间戳和coinbase交易信息均可更改，以此扩展nonce的位数 |

比特币的区块大小目前被严格限制在1MB以内。4字节的区块大小字段不包含在此内。

##### 两个概念

默克尔树：Merkle Tree，又被称为Hash Tree。顾名思义，是存储Hash值的存储结构；每条交易都有hash值，将所有交易按照手续费高低排序，第一笔交易是挖矿所得的coinbase交易。挖矿系统将该区块能容下的所有交易信息打包，两两hash。乳如果交易笔数是奇数，则复制自身后进行hash。Coinbase交易是每个区块中的第一个交易，该交易由矿工创建，交易内容是系统奖励给矿工的比特币；
默克尔根：生成一颗完整的Merkle树需要递归地对哈希节点对进行哈希，并将哈希节点插入到Merkle树中，直到只剩一个哈希节点，该节点就是Merkle树的根。在比特币系统中，区块头必须包含区块中所有交易哈希计算得到的有效Merkle根，是挖矿非常重要的参数。

**挖矿原理：**挖矿的过程就是重复计算区块头的Hash，不断修改随机数Nonce，直到小于难度目标Bits计算出来的Hash。挖到块的条件是前n个比特位全部为0，n越大，难度越大。

##### 区块链的本质

1）区块链式一组使用密码学算法产生的区块，每个区块按时间顺序依次相连，形成链状结构。
2）区块链可以理解成是一个类似电子表格的数据结构，通过互联网定时在分布式计算机节点上进行复制和更新。
3）区块链本质上是一个应用了密码学技术的，多方参与的，共同维护的，持续增长的分布式数据库系统，也称为分布式共享账本。
4）区块链数据由所有节点共同维护，所有节点共同维护一条不断增长的链，只能添加记录，不可删除，不可篡改记录。
5）区块链具有匿名性，去中心化，公开透明，不可篡改等特点。区块链本质上解决了信任和价值传递，在这种强信任背书的情况下，任何人没有能力，也没有必要质疑数据的质量和真实性。

**数字货币钱包种类**

冷钱包：：网络不能访问到的钱包。
热钱包：互联网能访问到私钥的钱包。

无论冷钱包还是热钱包，只要被知道了私钥，就具备控制比特币钱包的权力，因此，保存私钥的人才是真正拥有比特币的人。

比特币钱包的私钥：比特币钱包的原始私钥是`32字节`，每个字节是`8位`，也就是`256位`2进制数字，换算成16进制数字，就变成了`64位`长度。

##### 比特币地址是如何得到的？

eg：比特币地址其实是通过对160位二进制公钥哈希值，再进行base58check编码后得到的数据。
1）公钥先经过SHA256计算，再经过RIPEMD160算法；
2）再进行Base58Check编码；
3）由公钥生成的比特币地址以“1”开头。



































