#### 以太坊项目架构模型

##### 一，以太坊架构

学习以太坊的第一步，最重要的就是首先知道以太坊有什么功能和以太坊的基础架构。如下所示为以太坊逻辑架构图：

![image-20180828203305157](/var/folders/_n/0wz2n7dx27gcl3hd2sk1cfth0000gn/T/abnerworks.Typora/image-20180828203305157.png)

从下网上依次为：数据层，网络层，共识层，激励层，合约层，应用层共六层。

- 数据层：数据层本质上是一个数据库，用于存储区块链中的数据信息及以太坊网络中的数据内容，以太坊网络的存储是由levelDB数据库保存实现的，leveleDB的数据是以键值对的形式对数据进行存储。所有与交易相关的操作数据，都保存在区块中，并且每个区块连接起来，则构成更大的区块体系，称为区块链。所有交易或者操作，存在各个个体账户的状态（state）中，账户的呈现形式是为stateObject由stateDB统一管理。
- 网络层：以太坊底层分布式网络是由P2P网络实现的，使用了经典的Kademlia网络，可以称为kad，kad是一种能在本身节点周围查找临近节点的算法，最终通过UDP实现网络广播。为了能够在全网实现通讯，以太坊采用NAT穿透技术实现路由器的穿透，确保全世界以太坊节点信息保持一致。
- 共识层：共识层就是规定通过何种方式实现交易记录的过程。比如比特币采用的是工作量证明机制，用PoW标示，该共识算法完全取决于电脑的性能。以太坊也是采用PoW算法，但是PoW存在较大的弊端，比如浪费电力资源等，因此以太坊从PoW转向PoS算法的趋势。
- 激励层：以太坊采用PoW方式实现挖矿机制。挖到以太区块的节点会获得ETH代币激励。
- 合约层：最早的公链是没有合约层，所以最初的公链只能进行交易，而无法用于其他的领域或是进行其他的逻辑处理。从以太坊出现以后，合约层开始体现其强大的作用，通过合约层，开发者可以开发任意的DApp，实现完整的区块链生态系统，以太坊中这部分包含了以太坊虚拟机EVM和智能合约两个部分。
- 应用层：以太坊系统的最上层，也是和开发者直接相关联的一层。在现有的技术实现中，以太坊是使用Truffle和web3-js技术来实现Dapp的开发和智能合约的编写。基于此层开发DAPP，发行代币等都是在这个层面，通过DAPP提供的Web应用和智能合约交互。

##### 二，从结构上分析以太坊

以太坊最上层为Dapp。Dapp通过Web3.js和智能合约层进行交互。所有的智能合约都运行在EVM（以太坊虚拟机）上，并会用到RPC的调用。在EVM和RPC下面是以太坊的四大核心内容：blockchain，共识算法，挖矿以及网络模块。除了 DApp外，其他的所有部分都在以太坊的客户端里面，目前最流行的以太坊客户端就是Geth。模块层次图如下：

![image-20180828223740803](/var/folders/_n/0wz2n7dx27gcl3hd2sk1cfth0000gn/T/abnerworks.Typora/image-20180828223740803.png)

##### 三，从体系上分析以太坊

1. 区块链范式

   1.1基于交易的状态机系统

   	1.1.1创世区块起源

   	1.1.2状态改变到最终状态

   1.2账户状态

   	1.2.1账户余额

   	1.2.2名誉度

   	1.2.3信誉度

   	1.2.4显示世界附属

   	1.2.5描绘信息

   1.3交易是链的两个状态桥梁

   1.4一个有效的状态是通过交易进行的

   1.5区块链中交易信息，通过Hash算法连接

   1.6挖矿

   	1.6.1付出一系列工作量赢得交易记账权

   	1.6.2Proof of Work

   1.7单位

   	1.7.1内置货币单位

   	1.7.2换算

   	1.7.3价值标示Wei单位计算

   		1.7.3.1货币

   		1.7.3.2余额

   		1.7.3.3支付

2. 约定

3. 区块状态和交易

##### 四，以太坊简易框架

当前以太坊代码已经发布到了V1.8.n的版本，可以通过git tags去得到最早的0.2.0的代码版本，去查看最原始最简单的eth代码模块组成。

```
big.go
vm.go
parsing.go
transaction.go
block.go
block_manager.go
ethereum.go
serialization.go
```

